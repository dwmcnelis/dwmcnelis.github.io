!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Client",[],t):"object"==typeof exports?exports.Client=t():(e.PostRPC=e.PostRPC||{},e.PostRPC.Client=t())}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={exports:{},id:i,loaded:!1};return e[i].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,exports){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i="2.0",s=-32001,o="Timeout",r="The server didn't respond to request within timeframe allowed.",u=function(){function e(n){var i=this;t(this,e),this._name="PostRPC.Client",this._origin=n,this._id=1,this._queue=[],this._subscribed={},this._logging=!1,setInterval(function(){return i.timeoutHandler()},250)}return n(e,[{key:"subscribe",value:function(e,t){this.log(["subscribe","event: "+e,"callback: function() {}"]),this._subscribed[e]={callback:t}}},{key:"unsubscribe",value:function(e){delete this._subscribed[e]}},{key:"nextID",value:function(){return this._id++}},{key:"start",value:function(){var e=this;window.addEventListener("message",function(t){return e.messageHandler(t)})}},{key:"stop",value:function(){var e=this;window.removeEventListener("message",function(t){return e.messageHandler(t)})}},{key:"request",value:function(e,t,n){return{jsonrpc:i,method:e,params:t,id:n}}},{key:"timeoutResponse",value:function(e){return{jsonrpc:i,error:{code:s,message:o,data:r},id:e}}},{key:"call",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3;this.log(["call","method: "+e,"params: "+JSON.stringify(t),"callback: function() {}","timeout: "+i]),this._queue.push({method:e,params:t,id:this.id,sent:Date.now(),timeout:i,callback:n}),parent.postMessage(this.request(e,t,this.id),this._origin),this.nextID()}},{key:"timeoutHandler",value:function(){for(var e=Date.now(),t=this._queue.length-1;t>=0;t--){var n=this._queue[t];e-n.sent>n.timeout&&(this.log(["call expired, id: "+n.id,"timeout response","called, call callback"]),n.callback(this.timeoutResponse(n.id)),this._queue.splice(t,1))}}},{key:"messageHandler",value:function(e){if(e.origin===this._origin){var t=e.data,n=["response: "+JSON.stringify(t)];if(t&&t.id){n.push("call response");for(var i=this._queue.length-1;i>=0;i--){var s=this._queue[i];t.id===s.id&&(n.push("called, call callback"),s.callback(t),this._queue.splice(i,1))}}else if(t&&t.event&&(n.push("event response"),t.event in this._subscribed)){n.push("subscribed, call callback");var o=this._subscribed[t.event];o.callback(t)}this.log(n)}}},{key:"logging",value:function(e){this._logging=e}},{key:"log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"green";if(this._logging){console.group(this._name);for(var n=0;n<e.length;n++)console.log("%c%s","color:"+t,e[n]);console.groupEnd()}}},{key:"name",get:function(){return this._name}},{key:"origin",get:function(){return this._origin}},{key:"id",get:function(){return this._id}},{key:"subscribed",get:function(){return this._subscribed}}]),e}();exports.default=u,e.exports=exports.default}])});
//# sourceMappingURL=PostRPC.Client.min.js.map