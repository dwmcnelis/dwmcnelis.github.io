!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Server",[],t):"object"==typeof exports?exports.Server=t():(e.PostRPC=e.PostRPC||{},e.PostRPC.Server=t())}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,exports){"use strict";function t(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s="2.0",i=-32700,a="Parse error",u="Invalid JSON was received by the server.",l=-32600,d="Invalid request",c="The JSON sent is not a valid request object.",f=-32601,p="Method not found",g="The method does not exist / is not available.",h=-32602,v="Invalid params",y="Invalid method parameter(s).",m=-32603,b="Internal error",k="Internal JSON-RPC error.",j=function(){function e(t){r(this,e),this._name="PostRPC.Server",this._origin=t,this._registered={},this._logging=!1}return o(e,[{key:"register",value:function(e,t,r,n){this.log(["register","method: "+e,"params: "+JSON.stringify(t),"ret: "+JSON.stringify(r),"function: function() {}"]),this._registered[e]={params:t,return:r,function:n}}},{key:"unregister",value:function(e){delete this._registered[e]}},{key:"isValid",value:function(e){return!(!(e.jsonrpc===s&&e.method&&"method"in e)||e.method&&0===e.method.lastIndexOf("rpc.",0))}},{key:"isMethodFound",value:function(e){return e.method in this._registered}},{key:"parseErrorResponse",value:function(){return{jsonrpc:s,error:{code:i,message:a,data:u},id:null}}},{key:"invalidRequestResponse",value:function(e){return{jsonrpc:s,error:{code:l,message:d,data:c},id:e.id}}},{key:"methodNotFoundResponse",value:function(e){return{jsonrpc:s,error:{code:f,message:p,data:g},id:e.id}}},{key:"invalidParamsResponse",value:function(e){return{jsonrpc:s,error:{code:h,message:v,data:y},id:e.id}}},{key:"internalErrorResponse",value:function(e){return{jsonrpc:s,error:{code:m,message:b,data:k},id:e.id}}},{key:"success",value:function(e,t){return{jsonrpc:s,result:e,id:t}}},{key:"failure",value:function(e,t){return{jsonrpc:s,error:e,id:t}}},{key:"event",value:function(e,t){return{jsonrpc:s,result:e,event:t,id:null}}},{key:"publish",value:function(e,t){for(var r=["publish: name: "+e+", result: "+JSON.stringify(t)],n=0;n<window.frames.length;n++){var o=window.frames[n];o.postMessage(this.event(t,e),"*")}r.push("("+window.frames.length+") post publish"),this.log(r)}},{key:"start",value:function(){var e=this;window.addEventListener("message",function(t){return e.messageHandler(t)})}},{key:"stop",value:function(){var e=this;window.removeEventListener("message",function(t){return e.messageHandler(t)})}},{key:"messageHandler",value:function(e){var r=e.data,o=["request: "+JSON.stringify(r)];if(this.isValid(r))if(this.isMethodFound(r)){var s=this._registered[r.method].function,i=null;Array.isArray(r.params)?i=s.apply(void 0,t(r.params)):null!==r.params&&"object"===n(r.params)&&(i=s.apply(void 0,t(Object.values(r.params)))),o.push("post success"),e.source.postMessage(this.success(i,r.id),"*")}else o.push("post method not found"),e.source.postMessage(this.methodNotFoundResponse(r),"*");else o.push("post invalid"),e.source.postMessage(this.invalidRequestResponse(r),"*");this.log(o)}},{key:"logging",value:function(e){this._logging=e}},{key:"log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blue";if(this._logging){console.group(this._name);for(var r=0;r<e.length;r++)console.log("%c%s","color:"+t,e[r]);console.groupEnd()}}},{key:"name",get:function(){return this._name}},{key:"origin",get:function(){return this._origin}},{key:"registered",get:function(){return this._registered}}]),e}();exports.default=j,e.exports=exports.default}])});
//# sourceMappingURL=PostRPC.Server.min.js.map